stages:
  - build

linux:
  stage: build
  parallel:
    matrix:
      - IMAGE: ["ubuntu20.04:0.0.5", "noble:0.0.6"]
  image: iffregistry.fz-juelich.de/qtisas/qtisas-ci/$IMAGE
  script:
    - mkdir build && cd build
    - cmake .. -DCMAKE_BUILD_TYPE=Release
    - cmake --build . --parallel $CI_NPROC

macos-arm64:
  stage: build
  tags:
    - darwin, arm64, ventura
  parallel:
    matrix:
      - QT: ["qt", "qt@5 -DPREFER_QT=5"]
  script:
    - mkdir build && cd build
    - cmake ..
      -DCMAKE_PREFIX_PATH=/opt/homebrew/opt/$QT
    - /opt/homebrew/bin/cmake --build . --parallel $(sysctl -n hw.ncpu)

win-x64:
  stage: build
  tags:
    - win, x64
  parallel:
    matrix:
      - QT: "5.15.2/mingw81_64"
        CMPLR: "mingw810_64"
      - QT: "6.8.2/mingw_64"
        CMPLR: "mingw1310_64"
  script:
    - mkdir build
    - cd build
    - $env:Path = "C:\Qt\Tools\$CMPLR\bin;" + $env:Path
    - cmake ..
      -DCMAKE_BUILD_TYPE=Release
      -G"Ninja"
      -DCMAKE_C_COMPILER="gcc"
      -DCMAKE_CXX_COMPILER="g++"
      -DCMAKE_PREFIX_PATH="C:/Qt/$QT"
    - cmake --build . --parallel $env:NUMBER_OF_PROCESSORS
